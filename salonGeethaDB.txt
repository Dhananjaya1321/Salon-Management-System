
drop database SalonGeetha;
CREATE DATABASE IF NOT EXISTS SalonGeetha;
USE SalonGeetha;



CREATE TABLE IF NOT EXISTS Employee(
	Emp_Id VARCHAR(10),
	Name VARCHAR(40) NOT NULL,
	Address TEXT NOT NULL,
	DOB DATE NOT NULL,
	Phone_number VARCHAR(15) UNIQUE NOT NULL,
	Description TEXT,
	Email VARCHAR(50),
	NIC VARCHAR(15) NOT NULL UNIQUE,
	Job_title VARCHAR(15) NOT NULL,
CONSTRAINT PRIMARY KEY (Emp_Id)
);

CREATE TABLE IF NOT EXISTS User(
	User_name VARCHAR(20),
	Emp_Id VARCHAR(10),
	Password VARCHAR(250),
	CONSTRAINT PRIMARY KEY(User_name),
CONSTRAINT FOREIGN KEY (Emp_Id )  REFERENCES Employee(Emp_Id )
	ON UPDATE CASCADE
	ON DELETE CASCADE
);


CREATE TABLE IF NOT EXISTS Customer(
	NIC VARCHAR(15),
	Name VARCHAR(50) NOT NULL,
	Phone_number VARCHAR(15) NOT NULL,
	Email VARCHAR(50),
	DOB DATE NOT NULL,
	user_name VARCHAR(20),
CONSTRAINT PRIMARY KEY (NIC),	
CONSTRAINT FOREIGN KEY (user_name) REFERENCES User(user_name)
	ON UPDATE CASCADE	
);

CREATE TABLE IF NOT EXISTS Service(
	Sev_Id VARCHAR(10),
	Description TEXT,
	Name VARCHAR(20) NOT NULL,
	Price DOUBLE(7,2),
	Discount DOUBLE(3,2),
CONSTRAINT PRIMARY KEY (Sev_Id)
);


CREATE TABLE IF NOT EXISTS Employee_service_detail(
	Emp_Id VARCHAR(10),
	Sev_Id VARCHAR(10),
CONSTRAINT PRIMARY KEY (Emp_Id,Sev_Id),
CONSTRAINT FOREIGN KEY (Emp_Id) REFERENCES Employee(Emp_Id)
	ON UPDATE CASCADE
	ON DELETE CASCADE,
CONSTRAINT FOREIGN KEY (Sev_Id) REFERENCES Service(Sev_Id)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Appointment(
	Apt_Id VARCHAR(50),
	Date DATE NOT NULL,
	Time TIME NOT NULL,
	NIC VARCHAR(15),
CONSTRAINT PRIMARY KEY (Apt_Id),
CONSTRAINT FOREIGN KEY (NIC) REFERENCES Customer(NIC)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

ALTER TABLE Appointment ADD Status VARCHAR(20) DEFAULT 'Pending';

CREATE TABLE IF NOT EXISTS Service_appointment_detail(
	Apt_Id VARCHAR(50),
	Sev_Id VARCHAR(10),
CONSTRAINT PRIMARY KEY (Apt_Id,Sev_Id),
CONSTRAINT FOREIGN KEY (Sev_Id) REFERENCES Service(Sev_Id) 
	ON UPDATE CASCADE
	ON DELETE CASCADE,
CONSTRAINT FOREIGN KEY (Apt_Id) REFERENCES Appointment(Apt_Id) 
	ON UPDATE CASCADE
	ON DELETE CASCADE
);








CREATE TABLE IF NOT EXISTS Book(
	Bok_Id VARCHAR(50),
	Date DATE NOT NULL,
	Time TIME NOT NULL,
	NIC VARCHAR(15),
CONSTRAINT PRIMARY KEY (Bok_Id),
CONSTRAINT FOREIGN KEY (NIC) REFERENCES Customer(NIC)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

ALTER TABLE book DROP COLUMN time;
ALTER TABLE book ADD Status VARCHAR(20) DEFAULT 'Pending';



CREATE TABLE IF NOT EXISTS Appointment_payment(
	Pay_Id VARCHAR(10),
	Payment_method VARCHAR(20),
	NIC VARCHAR(15),
	Amount_due double(7,2),
	Apt_Id VARCHAR(50),
CONSTRAINT PRIMARY KEY (Pay_Id),
CONSTRAINT FOREIGN KEY (NIC) REFERENCES Customer (NIC)
	ON UPDATE CASCADE
	ON DELETE CASCADE,
CONSTRAINT FOREIGN KEY (Apt_Id) REFERENCES Appointment(Apt_Id)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);


ALTER TABLE Appointment_payment MODIFY COLUMN Payment_method VARCHAR(50);

CREATE TABLE IF NOT EXISTS Book_payment(
	Pay_Id VARCHAR(10),
	Payment_method VARCHAR(20),
	NIC VARCHAR(15),
	Amount_due double(7,2),
	Bok_Id VARCHAR(50),
CONSTRAINT PRIMARY KEY (Pay_Id),
CONSTRAINT FOREIGN KEY (NIC) REFERENCES Customer (NIC)
	ON UPDATE CASCADE
	ON DELETE CASCADE,
CONSTRAINT FOREIGN KEY (Bok_Id) REFERENCES Book (Bok_Id)
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

ALTER TABLE Book_payment MODIFY COLUMN Payment_method VARCHAR(50);


CREATE TABLE IF NOT EXISTS Rentals(
	Rent_Id VARCHAR(10),
	Name VARCHAR(50) NOT NULL,
	Price_pre_day DOUBLE(7,2) NOT NULL,
	Description TEXT,
	Avaliable_count INT NOT NULL,
	Discount DOUBLE(3,2),
CONSTRAINT PRIMARY KEY (Rent_Id )
);




CREATE TABLE IF NOT EXISTS Book_rentals_detail(
	Rent_Id VARCHAR(10),
	Bok_Id VARCHAR(50),
	Qty INT NOT NULL,
	For_how_many_days INT NOT NULL,
CONSTRAINT PRIMARY KEY (Rent_Id ,Bok_Id),
CONSTRAINT FOREIGN KEY (Rent_Id) REFERENCES Rentals(Rent_Id) 
	ON UPDATE CASCADE
	ON DELETE CASCADE,
CONSTRAINT FOREIGN KEY (Bok_Id) REFERENCES Book(Bok_Id) 
	ON UPDATE CASCADE
	ON DELETE CASCADE
);




CREATE TABLE IF NOT EXISTS Supplier(
	Sup_Id VARCHAR(10),
	Description TEXT,
	Name VARCHAR(50) NOT NULL,
	Address TEXT NOT NULL,
	Phone_number VARCHAR(15) NOT NULL,
	Email VARCHAR(50) NOT NULL,
CONSTRAINT PRIMARY KEY (Sup_Id)
);

CREATE TABLE IF NOT EXISTS Product(
	Pro_Id VARCHAR(10),
	Description TEXT,
	Category VARCHAR(50),
	Brand VARCHAR(50) NOT NULL,
	Unit_price DOUBLE(7,2) NOT NULL,
	Qty_on_hand INT NOT NULL,
	Sup_Id VARCHAR(10),
CONSTRAINT PRIMARY KEY (Pro_Id),
CONSTRAINT FOREIGN KEY (Sup_Id) REFERENCES Supplier (Sup_Id) 
	ON UPDATE CASCADE
	ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Product_service_detail(
	Pro_Id VARCHAR(10),
	Sev_Id VARCHAR(10),
	Qty INT NOT NULL,
CONSTRAINT PRIMARY KEY (Pro_Id,Sev_Id),
CONSTRAINT FOREIGN KEY (Sev_Id) REFERENCES Service(Sev_Id) 
	ON UPDATE CASCADE
	ON DELETE CASCADE,
CONSTRAINT FOREIGN KEY (Pro_Id) REFERENCES Product(Pro_Id) 
	ON UPDATE CASCADE
	ON DELETE CASCADE
);


CREATE TABLE IF NOT EXISTS Bill_payment(
	Bil_Id VARCHAR(10),
	Date DATE,
	Description TEXT,
	Title VARCHAR(20) NOT NULL,
	Amount_paid DOUBLE(7,2) NOT NULL,
	Emp_Id VARCHAR(10),
CONSTRAINT PRIMARY KEY (Bil_Id),
CONSTRAINT FOREIGN KEY (Emp_Id) REFERENCES Employee(Emp_Id) 
	ON UPDATE CASCADE
	ON DELETE CASCADE
);




